<div class="test-taking-content" style="max-width: 900px; margin: 0 auto; padding: 2rem;">
    <div class="question-progress" style="margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span>Câu hỏi: <strong id="current-question">1</strong>/<%= questions.length %></span>
            <span>Đã trả lời: <strong id="answered">0</strong>/<%= questions.length %></span>
        </div>
        <div class="progress-bar" style="height: 8px; background: #e0e0e0; border-radius: 4px;">
            <div id="progress-fill" style="height: 100%; background: #4A90E2; border-radius: 4px; width: 0%; transition: width 0.3s;"></div>
        </div>
    </div>

    <div id="question-container">
        <% questions.forEach((q, index) => { %>
        <div class="question-item" data-question="<%= index + 1 %>" style="<%= index === 0 ? '' : 'display: none;' %>">
            <h2 style="margin-bottom: 2rem;">Câu <%= index + 1 %>: <%= q.question %></h2>
            
            <div class="options-list" style="display: grid; gap: 1rem;">
                <% q.options.forEach((option, optIndex) => { %>
                <label class="option-item" style="display: flex; align-items: center; padding: 1rem; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                    <input type="radio" name="question-<%= index %>" value="<%= optIndex %>" style="margin-right: 1rem;">
                    <span><%= option %></span>
                </label>
                <% }); %>
            </div>
        </div>
        <% }); %>
    </div>

    <div class="navigation-buttons" style="display: flex; justify-content: space-between; margin-top: 2rem;">
        <button id="prev-btn" class="btn btn-outline" onclick="prevQuestion()" style="display: none;">
            ← Câu Trước
        </button>
        <button id="next-btn" class="btn btn-primary" onclick="nextQuestion()">
            Câu Tiếp →
        </button>
        <button id="submit-btn" class="btn btn-primary" onclick="submitTest()" style="display: none;">
            Nộp Bài
        </button>
    </div>
</div>

<script>
let currentQuestion = 1;
const totalQuestions = <%= questions.length %>;

function showQuestion(num) {
    document.querySelectorAll('.question-item').forEach(q => q.style.display = 'none');
    document.querySelector(`[data-question="${num}"]`).style.display = 'block';
    
    document.getElementById('current-question').textContent = num;
    document.getElementById('prev-btn').style.display = num > 1 ? 'block' : 'none';
    document.getElementById('next-btn').style.display = num < totalQuestions ? 'block' : 'none';
    document.getElementById('submit-btn').style.display = num === totalQuestions ? 'block' : 'none';
    
    updateProgress();
}

function nextQuestion() {
    if (currentQuestion < totalQuestions) {
        currentQuestion++;
        showQuestion(currentQuestion);
    }
}

function prevQuestion() {
    if (currentQuestion > 1) {
        currentQuestion--;
        showQuestion(currentQuestion);
    }
}

function updateProgress() {
    const answered = document.querySelectorAll('input[type="radio"]:checked').length;
    document.getElementById('answered').textContent = answered;
    document.getElementById('progress-fill').style.width = (answered / totalQuestions * 100) + '%';
}

function submitTest() {
    const answered = document.querySelectorAll('input[type="radio"]:checked').length;
    if (answered < totalQuestions) {
        if (!confirm(`Bạn mới trả lời ${answered}/${totalQuestions} câu. Bạn có chắc muốn nộp bài?`)) {
            return;
        }
    }
    alert('Nộp bài thành công!');
    window.location.href = '/student/results/1';
}

document.querySelectorAll('input[type="radio"]').forEach(input => {
    input.addEventListener('change', updateProgress);
});
</script>

<style>
.option-item:hover {
    border-color: #4A90E2 !important;
    background: #f0f8ff !important;
}
.option-item:has(input:checked) {
    border-color: #4A90E2 !important;
    background: #e3f2fd !important;
}
</style>
