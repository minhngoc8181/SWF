<!-- Page Header -->
<%- include('../partials/page-header', { 
    icon: 'ğŸ‘©â€ğŸ«', 
    title: 'Dashboard GiÃ¡o ViÃªn',
    description: 'Quáº£n lÃ½ lá»›p há»c vÃ  theo dÃµi há»c sinh'
}) %>

<!-- Stats Grid -->
<div class="stats-grid">
    <%- include('../partials/stats-card', { 
        icon: 'ğŸ‘¥', 
        gradient: 'linear-gradient(135deg, #667eea, #764ba2)',
        value: stats.totalStudents,
        label: 'Tá»•ng Há»c Sinh'
    }) %>
    
    <%- include('../partials/stats-card', { 
        icon: 'ğŸ“š', 
        gradient: 'linear-gradient(135deg, #f093fb, #f5576c)',
        value: stats.totalClasses,
        label: 'Lá»›p Há»c'
    }) %>
    
    <%- include('../partials/stats-card', { 
        icon: 'ğŸ“Š', 
        gradient: 'linear-gradient(135deg, #43e97b, #38f9d7)',
        value: stats.avgClassScore + '%',
        label: 'Äiá»ƒm TB Lá»›p'
    }) %>
    
    <%- include('../partials/stats-card', { 
        icon: 'âœ…', 
        gradient: 'linear-gradient(135deg, #fa709a, #fee140)',
        value: stats.assignmentsGraded,
        label: 'BÃ i ÄÃ£ Cháº¥m'
    }) %>
</div>

<!-- Classes Section -->
<%- include('../partials/section-header', { 
    icon: 'ğŸ“š', 
    title: 'Lá»›p Há»c'
}) %>

<div class="items-grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));">
    <% classes.forEach(cls => { %>
    <div class="item-card">
        <div class="item-header">
            <div class="item-icon-wrapper" style="background: <%= cls.color %>20; border-color: <%= cls.color %>;">
                <span>ğŸ“</span>
            </div>
            <div class="item-header-content">
                <h3 class="item-title"><%= cls.name %></h3>
                <div class="item-subtitle">
                    <span class="item-subtitle-icon">ğŸ‘¥</span>
                    <span><%= cls.students %> há»c sinh</span>
                </div>
            </div>
        </div>
        
        <div class="class-stats-section">
            <div class="class-stat-item">
                <span class="stat-icon">ğŸ“Š</span>
                <div class="stat-info">
                    <span class="stat-label">Äiá»ƒm TB</span>
                    <span class="stat-value" style="color: <%= cls.color %>;"><%= cls.avgScore %>%</span>
                </div>
            </div>
            <div class="class-stat-item">
                <span class="stat-icon">ğŸ“</span>
                <div class="stat-info">
                    <span class="stat-label">BÃ i táº­p</span>
                    <span class="stat-value"><%= cls.assignments || 0 %></span>
                </div>
            </div>
        </div>
        
        <div class="item-actions">
            <a href="/teacher/class/<%= cls.id %>" class="btn btn-primary">Xem Lá»›p</a>
            <a href="/teacher/assignments?class=<%= cls.id %>" class="btn btn-outline">BÃ i Táº­p</a>
        </div>
    </div>
    <% }); %>
</div>

<!-- Assignments Section -->
<%- include('../partials/section-header', { 
    icon: 'ğŸ“', 
    title: 'BÃ i Táº­p Äang Hoáº¡t Äá»™ng',
    link: { url: '/teacher/assignments', text: 'Xem Táº¥t Cáº£' }
}) %>

<div class="items-grid" style="grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));">
    <% assignments.slice(0, 6).forEach(assign => { 
        const progress = Math.round((assign.submitted / assign.total) * 100);
        const dueDate = new Date(assign.dueDate);
        const isOverdue = dueDate < new Date();
        let statusColor = '#667eea';
        let statusIcon = 'âœ“';
        let statusText = 'Äang hoáº¡t Ä‘á»™ng';
        
        if (isOverdue) {
            statusColor = '#ff6b6b';
            statusIcon = 'âš ï¸';
            statusText = 'QuÃ¡ háº¡n';
        } else if (progress >= 80) {
            statusColor = '#43e97b';
            statusIcon = 'âœ“';
            statusText = 'Tá»‘t';
        } else if (progress >= 50) {
            statusColor = '#fa709a';
            statusIcon = 'â°';
            statusText = 'Trung bÃ¬nh';
        }
    %>
    <div class="item-card">
        <!-- Header -->
        <div class="item-header">
            <div class="item-icon-wrapper" style="background: <%= statusColor %>20; border-color: <%= statusColor %>;">
                <span>ğŸ“</span>
            </div>
            <div class="item-header-content">
                <h3 class="item-title"><%= assign.title %></h3>
                <div class="item-subtitle">
                    <span class="item-subtitle-icon">ğŸ“š</span>
                    <span><%= assign.class %></span>
                </div>
            </div>
        </div>

        <!-- Status Badge -->
        <div style="margin: var(--spacing-md) 0;">
            <span class="item-badge" style="background: <%= statusColor %>20; color: <%= statusColor %>; border: 2px solid <%= statusColor %>40;">
                <span class="badge-icon"><%= statusIcon %></span>
                <%= statusText %>
            </span>
        </div>

        <!-- Meta Info -->
        <div class="item-meta">
            <span class="meta-item">
                <span class="icon">ğŸ“…</span>
                Háº¡n: <%= assign.dueDate %>
            </span>
            <span class="meta-item">
                <span class="icon">ğŸ‘¥</span>
                <%= assign.total %> há»c sinh
            </span>
        </div>

        <!-- Stats Bar -->
        <div class="item-stats-bar">
            <div class="stat-item">
                <span class="stat-label">ÄÃ£ ná»™p</span>
                <span class="stat-value" style="color: <%= statusColor %>;"><%= assign.submitted %></span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">ChÆ°a ná»™p</span>
                <span class="stat-value"><%= assign.total - assign.submitted %></span>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
                <span class="stat-label">Tiáº¿n Ä‘á»™</span>
                <span class="stat-value" style="color: <%= statusColor %>;"><%= progress %>%</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="item-progress" style="margin-top: var(--spacing-md);">
            <div class="progress-bar">
                <div class="progress-fill" style="width: <%= progress %>%; background: <%= statusColor %>;"></div>
            </div>
        </div>

        <!-- Actions -->
        <div class="item-actions">
            <a href="/teacher/assignment/<%= assign.id %>" class="btn btn-primary">Xem Chi Tiáº¿t</a>
            <a href="/teacher/assignment/<%= assign.id %>/grade" class="btn btn-outline">Cháº¥m BÃ i</a>
        </div>
    </div>
    <% }); %>
</div>

<style>
/* Class Stats Section */
.class-stats-section {
    display: flex;
    gap: 1rem;
    padding: var(--spacing-md);
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.03), rgba(118, 75, 162, 0.03));
    border-radius: 12px;
    margin-bottom: var(--spacing-md);
}

.class-stat-item {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.class-stat-item .stat-icon {
    font-size: 1.5rem;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.class-stat-item .stat-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.class-stat-item .stat-label {
    font-size: 0.75rem;
    color: var(--text-light);
    font-weight: 600;
}

.class-stat-item .stat-value {
    font-size: 1.25rem;
    font-weight: 700;
}

/* Progress Bar Styles */
.item-progress .progress-bar {
    height: 8px;
    background: rgba(0,0,0,0.06);
    border-radius: 4px;
    overflow: hidden;
}

.item-progress .progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
}
</style>
